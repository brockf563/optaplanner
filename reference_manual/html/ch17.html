<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 17. Design Patterns</title><link rel="stylesheet" type="text/css" href="css/jbossorg.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="OptaPlanner User Guide"/><link rel="up" href="index.html" title="OptaPlanner User Guide"/><link rel="prev" href="ch16.html" title="Chapter 16. Integration"/><link rel="next" href="ch18.html" title="Chapter 18. Development"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ch16.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch18.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 17. Design Patterns"><div class="titlepage"><div><div><h2 class="title"><a id="designPatterns"/>Chapter 17. Design Patterns</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch17.html#designPatternsIntroduction">17.1. Design Patterns Introduction</a></span></dt><dt><span class="section"><a href="ch17.html#assigningTimeToPlanningEntities">17.2. Assigning Time to Planning Entities</a></span></dt><dd><dl><dt><span class="section"><a href="ch17.html#timeslotPattern">17.2.1. Timeslot Pattern: Assign to a Fixed-Length Timeslot</a></span></dt><dt><span class="section"><a href="ch17.html#timeGrainPattern">17.2.2. TimeGrain Pattern: Assign to a Starting TimeGrain</a></span></dt><dt><span class="section"><a href="ch17.html#chainedThroughTime">17.2.3. Chained Through Time Pattern: Assign in a Chain that Determines Starting Time</a></span></dt></dl></dd><dt><span class="section"><a href="ch17.html#multiStragePlanning">17.3. Multi-stage planning</a></span></dt></dl></div><div class="section" title="17.1. Design Patterns Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="designPatternsIntroduction"/>17.1. Design Patterns Introduction</h2></div></div></div><p>These design patterns list and solve common design challenges.</p></div><div class="section" title="17.2. Assigning Time to Planning Entities"><div class="titlepage"><div><div><h2 class="title"><a id="assigningTimeToPlanningEntities"/>17.2. Assigning Time to Planning Entities</h2></div></div></div><p>Dealing with time and dates in planning problems may be problematic because it is dependent on the needs of your use
    case.</p><p>There are several representations of timestamps, dates, durations and periods in Java. Choose the right
    representation type for your use case:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">java.util.Date</code> (deprecated): a slow, error-prone way to represent timestamps. Do not
        use.</p></li><li class="listitem"><p><code class="literal">javax.time.LocalDateTime</code>, <code class="literal">LocalDate</code>, <code class="literal">DayOfWeek</code>,
        <code class="literal">Duration</code>, <code class="literal">Period</code>, ...: an accurate way to represent and calculate with
        timestamps, dates, ...</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Supports timezones and DST (Daylight Saving Time).</p></li><li class="listitem"><p>Requires Java 8 or higher.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>On Java 7 use its backport called <span class="emphasis"><em>ThreeTen Backport</em></span> instead.</p></li><li class="listitem"><p>On Java 6 or lower, use its predecessor called <span class="emphasis"><em>Joda Time</em></span> instead.</p></li></ul></div></li></ul></div></li><li class="listitem"><p><code class="literal">int</code> or <code class="literal">long</code>: Caches a timestamp as a simplified number of
        coarse-grained time units (such as minutes) from the start of the global planning time window or the
        epoch.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: a <code class="literal">LocalDateTime</code> of <code class="literal">1-JAN 08:00:00</code> becomes an
            <code class="literal">int</code> of <code class="literal">400</code> minutes. Similarly <code class="literal">1-JAN 09:00:00</code>
            becomes <code class="literal">460</code> minutes.</p></li><li class="listitem"><p>It often represents an extra field in a class, alongside the <code class="literal">LocalDateTime</code> field from which it was
            calculated. The <code class="literal">LocalDateTime</code> is used for user visualization, but the
            <code class="literal">int</code> is used in the score constraints.</p></li><li class="listitem"><p>It is faster in calculations, which is especially useful in the TimeGrain pattern.</p></li><li class="listitem"><p>Do not use if timezones or DST affect the score constraints.</p></li></ul></div></li></ul></div><p>There are also several designs for assigning a planning entity to a starting time (or date):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The starting time is fixed beforehand. It is not a planning variable (in such solver).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example, in the <a class="link" href="ch03.html#bedAllocation" title="3.3.5. Hospital Bed Planning (PAS - Patient Admission Scheduling)">hospital bed planning</a> example, the arrival
            day of each patient is fixed beforehand.</p></li><li class="listitem"><p>This is common in <a class="link" href="">multi stage planning</a>, when the starting time has been decided already in an earlier
            planning stage.</p></li></ul></div></li><li class="listitem"><p>The starting time is not fixed, it is a planning variable (genuine or shadow).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If all planning entities have the same duration, use the <a class="link" href="ch17.html#timeslotPattern" title="17.2.1. Timeslot Pattern: Assign to a Fixed-Length Timeslot">Timeslot
            pattern</a>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example in course scheduling, all lectures take 1 hour. Therefore, each timeslot is 1 hour.</p></li></ul></div></li><li class="listitem"><p>If the duration differs and time is rounded to a specifc time granularity (for example 5 minutes) use the
            <a class="link" href="ch17.html#timeGrainPattern" title="17.2.2. TimeGrain Pattern: Assign to a Starting TimeGrain">TimeGrain pattern</a>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example in meeting scheduling, all meetings start at 15 minute intervals. All meetings take
                15, 30, 45, 60, 90 or 120 minutes.</p></li></ul></div></li><li class="listitem"><p>If the duration differs and one task starts immediately after the previous task (assigned to the same
            executor) finishes, use the <a class="link" href="">Chained Through Time pattern</a>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example in time windowed vehicle routing, each vehicle departs immediately to the next
                customer when the delivery for the previous customer finishes.</p></li></ul></div></li></ul></div></li></ul></div><p>Choose the right pattern depending on the use case:</p><div class="mediaobject"><img src="images/Chapter-Design_patterns/assigningTimeToPlanningEntities.png"/></div><div class="section" title="17.2.1. Timeslot Pattern: Assign to a Fixed-Length Timeslot"><div class="titlepage"><div><div><h3 class="title"><a id="timeslotPattern"/>17.2.1. Timeslot Pattern: Assign to a Fixed-Length Timeslot</h3></div></div></div><p>If all planning entities have <span class="bold"><strong>the same duration</strong></span> (or can be inflated to the
      same duration), the Timeslot pattern is useful. The planning entities are assigned to a timeslot rather than
      time. For example in <a class="link" href="ch03.html#curriculumCourse" title="3.3.1. Course Timetabling (ITC 2007 Track 3 - Curriculum Course Scheduling)">course timetabling</a>, all lectures take 1
      hour.</p><p>The timeslots can start at any time. For example, the timeslots start at 8:00, 9:00, 10:15 (after a 15-minute break), 11:15, ... They can even overlap, but that is unusual.</p><p>It is also usable if all planning entities can be inflated to the same duration. For example in <a class="link" href="ch03.html#examination" title="3.4.1. Exam Timetabling (ITC 2007 track 1 - Examination)">exam timetabling</a>, some exams take 90 minutes and others 120 minutes, but all
      timeslots are 120 minutes. When an exam of 90 minutes is assigned to a timeslot, for the remaining 30 minutes, its
      seats are occupied too and cannot be used by another exam.</p><p>Usually there is a second planning variable, for example the room. In course timetabling, two lectures are in
      conflict if they share the same room at the same timeslot. However, in exam timetabling, that is allowed, if there is
      enough seating capacity in the room (although mixed exam durations in the same room do inflict a soft score
      penalty).</p></div><div class="section" title="17.2.2. TimeGrain Pattern: Assign to a Starting TimeGrain"><div class="titlepage"><div><div><h3 class="title"><a id="timeGrainPattern"/>17.2.2. TimeGrain Pattern: Assign to a Starting TimeGrain</h3></div></div></div><p>Assigning humans to start a meeting at 4 seconds after 9 o'clock is pointless because most human activities have a time granularity of 5 minutes or 15 minutes. Therefore
      it is not necessary to allow a planning entity to be assigned subsecond, second or even 1 minute accuracy. The 5
      minute or 15 minutes accuracy suffices. The TimeGrain pattern models such <span class="bold"><strong>time
      accuracy</strong></span> by partitioning time as time grains. For example in <a class="link" href="ch03.html#meetingScheduling" title="3.2.6. Meeting Scheduling">meeting
      scheduling</a>, all meetings start/end in hour, half hour, or 15-minute intervals before or after each hour, therefore the optimal settings for time
      grains is 15 minutes.</p><p>Each planning entity is assigned to a start time grain. The end time grain is calculated by adding the
      duration in grains to the starting time grain. Overlap of two entities is determined by comparing their start and
      end time grains.</p><p>This pattern also works well with a coarser time granularity (such as days, half days, hours, ...). With a
      finer time granularity (such as seconds, milliseconds, ...) and a long time window, the value range (and therefore
      <a class="link" href="ch06.html#searchSpaceSize" title="6.1. Search Space Size in the Real World">the search space</a>) can become too high, which reduces efficiency and scalability.
      However, such solution is not impossible, as shown in <a class="link" href="ch03.html#cheapTimeScheduling" title="3.4.4. Cheap Time Scheduling">cheap time scheduling</a>.</p></div><div class="section" title="17.2.3. Chained Through Time Pattern: Assign in a Chain that Determines Starting Time"><div class="titlepage"><div><div><h3 class="title"><a id="chainedThroughTime"/>17.2.3. Chained Through Time Pattern: Assign in a Chain that Determines Starting Time</h3></div></div></div><p>If a person or a machine continuously works on <span class="bold"><strong>1 task at a time in sequence</strong></span>,
      which means starting a task when the previous is finished (or with a deterministic delay), the Chained Through Time pattern
      is useful. For example, in the vehicle routing with time windows example, a vehicle drives from customer to
      customer (thus it handles one customer at a time).</p><p>In this pattern, the planning entities are <a class="link" href="ch04.html#chainedPlanningVariable" title="4.3.5.4. Chained Planning Variable (TSP, VRP, ...)">chained</a>. The
      anchor determines the starting time of its first planning entity. The second entity's starting time is calculated
      based on the starting time and duration of the first entity. For example, in task assignment, Beth (the anchor)
      starts working at 8:00, thus her first task starts at 8:00. It lasts 52 mins, therefore her second task starts at 8:52. The
      starting time of an entity is usually <a class="link" href="ch04.html#shadowVariable" title="4.3.6. Shadow Variable">a shadow variable</a>.</p><p>An anchor has only one chain. Although it is possible to split up the anchor into two separate anchors, for
      example split up Beth into Beth's left hand and Beth's right hand (because she can do two tasks at the same time),
      this model makes pooling resources difficult. Consequently, using this model in the exam scheduling example
      to allow two or more exams to use the same room at the same time is problematic.</p><p>Between planning entities, there are three ways to create gaps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>No gaps: This is common when the anchor is a machine. For example, a build server always starts the next
          job when the previous finishes, without a break.</p></li><li class="listitem"><p>Only deterministic gaps: This is common for humans. For example, any task that crosses the 10:00 barrier
          gets an extra 15 minutes duration so the human can take a break. </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A deterministic gap can be subjected to complex business logic. For example in vehicle routing, a
              cross-continent truck driver needs to rest 15 minutes after 2 hours of driving (which may also occur during
              loading or unloading time at a customer location) and also needs to rest 10 hours after 14 hours of
              work.</p></li></ul></div></li><li class="listitem"><p>Planning variable gaps: This is uncommon, because an extra planning variable (which impacts the <a class="link" href="ch06.html#searchSpaceSize" title="6.1. Search Space Size in the Real World">search space</a>) reduces efficiency and scalability.</p></li></ul></div></div></div><div class="section" title="17.3. Multi-stage planning"><div class="titlepage"><div><div><h2 class="title"><a id="multiStragePlanning"/>17.3. Multi-stage planning</h2></div></div></div><p>For practical or organizational reasons (such as Conway's law), complex planning problems are often broken
    down in multiple stages. A typical example is train scheduling, where one department decides where and when a train
    will arrive or depart, and another departments assigns the operators to the actual train cars/locomotives.</p><p>Each stage has its own solver configuration (and therefore its own <code class="literal">SolverFactory</code>). Do not
    confuse it with <a class="link" href="ch06.html#solverPhase" title="6.7. Solver Phase">multi-phase solving</a> which uses a one-solver configuration.</p><p>Similarly to <a class="link" href="ch13.html" title="Chapter 13. Partitioned Search">Partitioned Search</a>, multi-stage planning leads to
    suboptimal results. Nevertheless, it may be beneficial in order to simplify the maintenance, ownership, and help to start a project.</p></div></div><script type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script type="text/javascript">
dataLayer = [{'channel' : 'OptaPlanner', 'additional_tracking_code' : 'UA-39485370-1'}];
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJWS5L');</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NJWS5L" height="0" width="0" style="display:none;visibility:hidden"> </iframe></noscript><ul class="docnav"><li class="previous"><a accesskey="p" href="ch16.html"><strong>Prev</strong>Chapter 16. Integration</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch18.html"><strong>Next</strong>Chapter 18. Development</a></li></ul></body></html>